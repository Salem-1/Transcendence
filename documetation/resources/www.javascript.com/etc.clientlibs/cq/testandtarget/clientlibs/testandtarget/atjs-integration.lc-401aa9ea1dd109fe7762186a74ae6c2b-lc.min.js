window.CQ_Analytics||(window.CQ_Analytics={});
(function(n,g){g.mboxes=g.mboxes||[];var l=function(g,h){function k(a){v&&console.log(a)}function n(a){try{0===a.indexOf("/")&&p&&0!==a.indexOf(p+"/")&&(a=p+a)}catch(c){}return a}function w(a){try{var c=g.ajax({type:"GET",url:n(a),async:!1,externalize:!1,encodePath:!1,hook:!1});return c?c:null}catch(b){return null}}function q(){var a=top.document.location.pathname;a=a.substring(0,a.indexOf(".",a.lastIndexOf("/")));var c=navigator?navigator.userAgent.toLowerCase():"other";if(0<c.indexOf("trident/")){var b=
c.indexOf("rv:");if("11"==parseInt(c.substring(b+3,c.indexOf(".",b)),10))return-1<a.indexOf("/editor.html/")}return a.includes("/editor.html/")}function x(a){var c=(new URL(document.location.href)).searchParams.get("wcmmode");q()&&(c="disabled");c&&0<c.length&&(a=a+"?wcmmode\x3d"+c);return a}function r(a,c){a=x(a);var b=(a=w(window.targetGlobalSettings.currentPagePath+".targetoffer.html"+a))&&a.responseText&&0<a.responseText.length;if(a&&a.status&&200===a.status&&b){b=document.getElementById(c);var d=
!1;if(b){for(;b.firstChild;)b.removeChild(b.firstChild);d=b.getElementsByTagName("div");1===d.length&&(b=d[0]);d=document.createElement("div");d.innerHTML=a.responseText;b.appendChild(d);d=b.getElementsByTagName("script");for(var e=0;e<d.length;e++)eval(d[e].text);d=!0;if(b=b.parentElement)e=document.createEvent("CustomEvent"),e.initEvent("target-dom-loaded",!0,!1),e.mboxName=c,b.dispatchEvent(e)}d||document.write(a.responseText)}}function m(){for(var a=0;a<h.mboxes.length;a++){var c={};Array.isArray(h.mboxes[a].staticParameters)&&
h.mboxes[a].staticParameters.map(function(a,b){a=a.split("\x3d");2===a.length&&(c[a[0]]=a[1])});for(var b=0;b<CQ_Analytics.mboxes[a].mappings.length;b++){var d="",e=CQ_Analytics.mboxes[a].mappings[b].param,g="/"+h.mboxes[a].mappings[b].ccKey.replace(".","/");-1<h.mboxes[a].isProfile.indexOf(e)&&(d="profile.");g=h.DataProvider.replaceVariables(y(g));c[d+e]="undefined"!==typeof g?g:""}h.mboxes[a].includeResolvedSegments&&h.SegmentMgr&&0<h.SegmentMgr.getResolved().length&&(c["profile._cq_.resolvedSegments"]=
"|"+h.SegmentMgr.getResolved().join("|")+"|");(function(c,b){setTimeout(function(){CQ_Analytics.TestTarget.updateMboxContent(c,b)},0<a?100:0)})(h.mboxes[a].name,c)}}function y(a){var c=void 0;(a=window.ContextHub?ContextHub.get(a):h.ClientContext.get(a))&&(Array.isArray(a)?c=a.join(","):"object"!==typeof a&&(c=a));return c}function t(){var a=[];if(window.CQ_Analytics&&window.CQ_Analytics.TestTarget&&window.CQ_Analytics.TestTarget.mappings)for(var c in window.CQ_Analytics.TestTarget.mappings)a.push(c);
return a}function z(){if("undefined"!==typeof CQ&&CQ.WCM&&CQ.utils&&CQ.utils.WCM)return CQ.WCM.isPreviewMode()||CQ.utils.WCM.isEditMode();var a=(document.cookie||"").split(/;\s*/).reduce(function(a,b){(b=b.match(/([^=]+)=(.*)/))&&(a[b[1]]=unescape(b[2]));return a},{});return"undefined"===typeof a.wcmmode||"preview"===a.wcmmode||"edit"===a.wcmmode}function u(){var a=document.querySelector('[class*\x3d"aem-AuthorLayer"]');return a?a.className.match("aem-AuthorLayer-[^ ]+")[0]:null}var A=/^(?:http|https):\/\/[^/]+(\/.*)\/(?:etc\.clientlibs|etc(\/.*)*\/clientlibs|libs(\/.*)*\/clientlibs|apps(\/.*)*\/clientlibs|etc\/designs).*\.js(\?.*)?$/,
d={};if(this.constructor===l.prototype)throw"This is a singleton!";if(l.instance)return l.instance;l.instance=d;var v=-1!==window.location.href.indexOf("debug-mbox-calls\x3d1"),p=function(){try{if(window.CQURLInfo)return CQURLInfo.contextPath||"";for(var a=document.getElementsByTagName("script"),c=0;c<a.length;c++){var b=A.exec(a[c].src);if(b)return b[1]}}catch(f){}return""}();d.registeredCHListeners={};d.usedStoresLoaded=!1;d.defaults={};d.mappings=[];d.maxProfileParams=200;d.pull=function(a,c,b){"undefined"===
typeof b&&(a=a.replace(/(\/content\/campaigns\/.*?)\/(.*)/,"$1/master/$2"));r(a,c)};d.displayOffer=function(a,c){adobe.target.getOffer({mbox:a,params:c,success:function(b){adobe.target.applyOffer({mbox:a,selector:"#"+a,offer:b})},error:function(b,c){console.error(b,c);g("#"+a).css("visibility","visible")}})};d.updateMboxContent=function(a,c){k("Updating content for mbox "+a);if(q()){var b=u();b?"aem-AuthorLayer-Edit"===b?d.signalDefaultOffer(a):d.displayOffer(a,c):setTimeout(function(){d.updateMboxContent(a,
c)},100)}else d.displayOffer(a,c)};d.registerMboxUpdateCalls=function(){"undefined"!==typeof window.CQ_Analytics&&window.CQ_Analytics.TestTarget.mappings&&(k("[Target][init] Registering Mbox update calls"),0<t().length?d.registerContextHubListeners():m())};d.registerContextHubListeners=function(){if(window.ContextHub){for(var a=t(),c=[],b=0;b<a.length;b++){var f=a[b],e=f.split(".")[0];f="/"+f.replace(".","/");ContextHub.get(e)&&!d.registeredCHListeners[e]&&(d.registeredCHListeners[e]=!0,c.push(f),
k("[Target][CH] - Listening for updates on "+f+" CH"))}0<c.length&&ContextHub.bind(c,function(a){k("[Target][CH][registerContextHubListeners] All properties available, triggering update!");m();d.usedStoresLoaded=!0},function(a){k("[Target][CH][registerContextHubListeners] Not all properties available, triggering update!");d.usedStoresLoaded||m()},500)}};d.addMbox=function(a){var c=!1,b=!1;CQ_Analytics.mboxes||(CQ_Analytics.mboxes=[]);for(var f=0;f<CQ_Analytics.mboxes.length;f++){var e=CQ_Analytics.mboxes[f];
if(e.id===a.id){CQ_Analytics.mboxes.splice(f,1);c=!0;b=e.defined;break}}a.defined=b;h.mboxes.push(a);a=a.mappings;for(b=0;b<a.length;b++)f=a[b].ccKey,d.mappings[f]||(d.mappings[f]={});return c};d.triggerUpdate=function(a){"undefined"===typeof a&&(a=500);d.reloadRequested||(d.reloadRequested=!0,setTimeout(function(){var a=u();("aem-AuthorLayer-Edit"===a||"aem-AuthorLayer-Preview"===a||z())&&m();d.reloadRequested=!1},a))};d.signalDefaultOffer=function(a){"undefined"===typeof d.defaults[a]?console&&
console.log("The default offer path was not found in the internal map for mbox "+a):(r(d.defaults[a],a),g("#"+a).css("visibility","visible"))};return d};g.TestTarget=l(n,g);top.$(top.document).on("editor-frame-mode-changed",function(){CQ_Analytics&&CQ_Analytics.TestTarget&&CQ_Analytics.TestTarget.triggerUpdate()})})($,window.CQ_Analytics);